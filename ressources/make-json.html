<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>JsonAble</title>
</head>
<body>
<h1>Transformer un fichier texte en tableau json</h1>
<input type="file" id="file-input" />
<h3>Contents of the file:</h3>
<pre id="file-content"></pre>
<script src="FileSaver.js"></script>
<script>
    (function () {
        "use strict";

        function makeJson(contents) {
            let tableauMots =  contents.split("\n");
            //enlève les \r
            for (let i = 0 ; i < tableauMots.length ; i ++) {
                tableauMots[i] = tableauMots[i].replace('\r', '');
                // console.log("remplacé", tableauMots[i]);
            }
            console.log("Mots Chargés !");
            // console.log("tableauMot",  tableauMots);
            let json = JSON.stringify(tableauMots);
            // console.log(json);
            save(json, prompt("Quel nom vouez-vous pour votre fichier ?"));
        }

        function save(mapForSaveTxt, fileName) {
            let blob = new Blob([mapForSaveTxt], {type: "text/plain;charset=utf-8"});
            saveAs(blob, fileName + ".json");
            console.log("savvvee");
        }

        function readSingleFile(e) {
            var file = e.target.files[0];
            if (!file) {
                return;
            }
            var reader = new FileReader();
            reader.onload = function(e) {
                var contents = e.target.result;
                displayContents(contents);
                 makeJson(contents);
            };
            reader.readAsText(file);
        }

        function displayContents(contents) {
            var element = document.getElementById('file-content');
            element.textContent = contents;
             // console.log("je l'ai");
        }

        document.getElementById('file-input')
            .addEventListener('change', readSingleFile, false);
    }());

</script>
</body>
</html>